[gd_scene load_steps=14 format=3 uid="uid://fw6h2kami5qi"]

[ext_resource type="Texture2D" path="res://Assets/Sprites/sheets/lawnboy_move_nomowers.png" id="1_tfrv6"]

[sub_resource type="GDScript" id="GDScript_hkekk"]
script/source = "extends Area2D

var animation_speed = 5
var moving = false

var tile_size = 16
var inputs = {\"right\": Vector2.RIGHT,
			\"left\": Vector2.LEFT,
			\"up\": Vector2.UP,
			\"down\": Vector2.DOWN,}
var pressed_inputs = []
@onready var ray = $RayCast2D
@onready var anim_player = $Lawnboy_AnimationPlayer


# Called when the node enters the scene tree for the first time.
func _ready():
	position = position.snapped(Vector2.ONE * tile_size)
	position += Vector2.ONE * tile_size/2
	anim_player.play(\"face_down\")


## Moves the player character in the direction input.
func move(dir):
	ray.target_position = inputs[dir] * tile_size
	ray.force_raycast_update()
	if !ray.is_colliding():
		var tween = create_tween()
		tween.tween_property(self, 
							\"position\", position + inputs[dir]*tile_size, 
							1.0/animation_speed).set_trans(Tween.TRANS_LINEAR)
		tween.tween_callback(func(): moving = false)


## Tracks the keys that have been pressed down for movement. Maximum size of 4
func _update_pressed_input_keys():
	for dir in inputs.keys():
		if Input.is_action_just_pressed(dir):
			pressed_inputs.append(dir)
		if Input.is_action_just_released(dir):
			pressed_inputs.erase(dir)


## Checks the inputs list to ensure that the player stops moving when opposing keys are pressed.
func _check_input_canceling(move_dir):
	if move_dir == \"left\":
		if self.pressed_inputs.has(\"right\"):
			return false
	elif move_dir == \"right\":
		if self.pressed_inputs.has(\"left\"):
			return false
	if move_dir == \"up\":
		if self.pressed_inputs.has(\"down\"):
			return false
	elif move_dir == \"down\":
		if self.pressed_inputs.has(\"up\"):
			return false	
	
	return true

		

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	_update_pressed_input_keys()
	
	# Movement processing
	if !pressed_inputs.is_empty():
		var no_opposing_directions = _check_input_canceling(pressed_inputs.back())
		if !moving and no_opposing_directions:
			moving = true
			var anim_str = \"walk_\" + pressed_inputs.back()
			anim_player.play(anim_str)
			move(pressed_inputs.back())
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_6nhfe"]
size = Vector2(16, 16)

[sub_resource type="Animation" id="Animation_m3d42"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [8]
}

[sub_resource type="Animation" id="Animation_psqm3"]
resource_name = "face left"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [4]
}

[sub_resource type="Animation" id="Animation_kjg4t"]
resource_name = "face_down"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [1]
}

[sub_resource type="Animation" id="Animation_lcc08"]
resource_name = "face_right"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [7]
}

[sub_resource type="Animation" id="Animation_i4eb5"]
resource_name = "face_up"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [10]
}

[sub_resource type="Animation" id="Animation_rhoj8"]
resource_name = "walk_down"
length = 0.6
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3, 0.45),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 1]
}

[sub_resource type="Animation" id="Animation_cy2d7"]
resource_name = "walk_left"
length = 0.6
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3, 0.45),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [3, 4, 5, 4]
}

[sub_resource type="Animation" id="Animation_f5f80"]
resource_name = "walk_right"
length = 0.6
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3, 0.45),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [6, 7, 8, 7]
}

[sub_resource type="Animation" id="Animation_5fug3"]
resource_name = "walk_up"
length = 0.6
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("LawnboyMoveNomowers:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3, 0.45),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [9, 10, 11, 10]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_yf1ge"]
_data = {
"RESET": SubResource("Animation_m3d42"),
"face left": SubResource("Animation_psqm3"),
"face_down": SubResource("Animation_kjg4t"),
"face_right": SubResource("Animation_lcc08"),
"face_up": SubResource("Animation_i4eb5"),
"walk_down": SubResource("Animation_rhoj8"),
"walk_left": SubResource("Animation_cy2d7"),
"walk_right": SubResource("Animation_f5f80"),
"walk_up": SubResource("Animation_5fug3")
}

[node name="LawnBoy" type="Area2D"]
position = Vector2(56, 88)
script = SubResource("GDScript_hkekk")

[node name="LawnboyMoveNomowers" type="Sprite2D" parent="."]
texture_filter = 1
texture = ExtResource("1_tfrv6")
hframes = 3
vframes = 4
frame = 8

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_6nhfe")

[node name="Lawnboy_AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_yf1ge")
}

[node name="RayCast2D" type="RayCast2D" parent="."]
